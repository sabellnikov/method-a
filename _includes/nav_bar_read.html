{% assign hover_link = '
      class="font-semibold rounded-full py-1 text-center whitespace-nowrap text-sm px-2 sm:text-base sm:px-2"
      style="background:var(--color-hover-current-page); color:var(--color-text-current-page)"
' %}

{% assign usual_link = '
      class="font-semibold rounded-full hover:bg-[var(--color-custom-hover)] py-1 text-center whitespace-nowrap text-sm px-2 sm:text-base sm:px-2"
' %}


<div class="fixed left-0 right-0 bottom-4 z-50 flex justify-center sm:top-4 sm:bottom-auto sm:left-1/2 sm:right-auto sm:-translate-x-1/2">
  <div id="nav-bar" class="inline-flex h-10 sm:h-12 rounded-full items-center justify-between px-5 bg-white/40 backdrop-blur-md w-full max-w-xs sm:w-auto sm:max-w-none">
    <button
      onclick="goToPreviousPage()"
      {{ usual_link }}  >
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24">
        <path d="M19 12H5M5 12l7 7M5 12l7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <!-- Заголовки -->
    <div class="relative group">
      {% if content %}
        <button
          id="toc-btn"
          class="font-semibold rounded-full hover:bg-[var(--color-custom-hover)] py-1 text-center whitespace-nowrap text-sm px-2 sm:text-base sm:px-2 focus:outline-none"
          type="button"
          aria-expanded="false"
          aria-controls="toc-dropdown">
          СОДЕРЖАНИЕ
        </button>

        <!-- TOC dropdown menu -->
        <div id="toc-dropdown"
          class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 sm:top-full sm:bottom-auto sm:mt-2 sm:mb-0 w-full max-w-xs sm:w-96 backdrop-blur-md rounded-lg opacity-0 invisible scale-95 transition-all duration-300 ease-out origin-bottom sm:origin-top z-50"
          style="background-color: var(--color-nav-bg);"
          tabindex="-1">
          <div class="p-1">
            {% assign headings = content | split: '<h' %}
            {% for heading in headings %}
              {% if forloop.first == false %}
                {% assign heading_parts = heading | split: '>' %}
                {% if heading_parts.size > 1 %}
                  {% assign heading_rest = heading_parts[1] %}
                  {% assign heading_content = heading_rest | split: '</h' | first | strip_html | strip %}
                  
                  {% if heading_content != '' %}
                    {% assign heading_id = heading_content | slugify %}
                    <a href="#{{ heading_id }}" class="block px-4 py-2 text-sm hover:bg-[var(--color-custom-hover)] rounded-lg m-1 transition-colors duration-200 no-underline focus:bg-[var(--color-custom-hover)] focus:outline-none">{{ heading_content }}</a>
                  {% endif %}
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% else %}
        <span class="text-sm opacity-60">No headings</span>
      {% endif %}
    </div>
    
    <!-- Кнопка сердечка -->
    <div class="flex items-center space-x-1">
      <button
        id="heart-btn"
        class="heart-btn font-semibold rounded-full hover:bg-[var(--color-custom-hover)] py-1 text-center whitespace-nowrap text-sm px-2 sm:text-base sm:px-2"
        onclick="toggleHeart(this)">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Стили модального окна сердечка -->
<div id="heartModal" class="modal-overlay" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div style="font-size: 3rem; margin-bottom: 1rem;">❤️</div>
    <h3 id="modal-title" style="margin-bottom: 1rem; color: #333;"></h3>
    <p id="modal-text" style="color: #666; margin-bottom: 1.5rem;"></p>
    <button onclick="closeModal()" style="background: #ef4444; color: white; border: none; padding: 0.5rem 1.5rem; border-radius: 8px; cursor: pointer;">
      Закрыть
    </button>
  </div>
</div>